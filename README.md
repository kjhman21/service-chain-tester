# Test Script for Service Chain Value Transfer

## prerequisites
* node v12 (tested version: v12.22.9)

## Getting Started

### Install dependencies

```bash
$ npm install
```

### Make bridge_info.json

You can find what values are required from [bridge_info.template.json](bridge_info.template.json).

This file can be generated by [klaytn-deploy](https://github.com/Krustuniverse-Klaytn-Group/klaytn-deploy).

```bash
klaytn-deploy$ ./deploy klaytn scconf
writing to file service-chain/bridge_info_0.json
writing to file service-chain/bridge_info_1.json
writing to file service-chain/bridge_info_2.json
```

Copy any one to `bridge_info.json`


### Deploy contracts

This will deploy contracts (bridge contracts, ERC-20, and ERC-721 contracts).

```bash
$ ./1.deploy.sh
using default bridgeInfoFilename.
bridgeInfoFilename = bridge_info.json
Deploying bridges...
deployed address: 0xA6FF58B0965Dc5E19C3BCCaf2AAb2485dbFf5f0F
Registering operator...
deployed address: 0x603f01A6aB6516750007793e964E7488Bb3B009B
Registering operator...
Deploying ERC20 tokens...
deployed address: 0x825A2b8e1569aA6e48C760BE63d2aaeD1461CeC0
adding the bridge operator to the minter...
adding the bridge contract to the minter...
deployed address: 0xb858289AB9Fb149d8be17Eef5500304f58F9e0d1
adding the bridge operator to the minter...
adding the bridge contract to the minter...
registering ERC20 to the parent bridge...
registering ERC20 to the child bridge...
Deploying ERC721 tokens...
deployed address: 0xDfdfaD91F47E14485820F5D963c7302653e5696D
adding the bridge operator to the minter...
adding the bridge contract to the minter...
deployed address: 0x73045526aBC5c771d4d18ed230D366e13612Af8E
adding the bridge operator to the minter...
adding the bridge contract to the minter...
registering ERC721 to the parent bridge...
registering ERC721 to the child bridge...
Storing deployed information to deployed_bridge_info.json
registering bridges to the child node
subscribing bridges to the child node
register token to subbridge..
Everything is done!
```

## Test value transfer

This will test transferring KLAY, ERC-20 and ERC-721 tokens.

```bash
$ ./2.transfer.sh
using default deployedBridgeInfoFilename.
deployedBridgeInfoFilename = deployed_bridge_info.json
Testing KLAY transfer (parent to child)...
recipient balance: 21
source bridge balance: 10000
target bridge balance: 10000
waiting 10 sec...
recipient balance: 22
source bridge balance: 10001
target bridge balance: 9999
Testing KLAY transfer (child to parent)...
recipient balance: 6
source bridge balance: 9999
target bridge balance: 10001
waiting 10 sec...
recipient balance: 7
source bridge balance: 10000
target bridge balance: 10000
Testing ERC20 transfer (parent to child)...
sender balance: 1000000000000000000000000000
recipient balance: 0
source bridge balance: 0
target bridge balance: 0
waiting 10 sec...
sender balance: 999999999999999999999999999
recipient balance: 1
source bridge balance: 0
target bridge balance: 0
Testing ERC20 transfer (child to parent)...
sender balance: 1000000000000000000000000000
recipient balance: 0
source bridge balance: 0
target bridge balance: 0
waiting 10 sec...
sender balance: 999999999999999999999999999
recipient balance: 1
source bridge balance: 0
target bridge balance: 0
Testing ERC721 transfer (parent to child)...
minting an NFT (43065)... 
check the NFT owner...
transferring NFT...
waiting 10 sec...
check the NFT owner...
Successfully transferred!
Testing ERC721 transfer (child to parent)...
minting an NFT (28626)... 
check the NFT owner...
transferring NFT...
waiting 10 sec...
check the NFT owner...
Successfully transferred!
```